<html>
<head>
	<!-- Meta -->
	<meta charset="UTF-8">
	<title>Shinto</title>
	<!-- Styles -->
	<link rel="stylesheet" href="css/normalize.css">
	<link rel="stylesheet" href="css/skeleton.css">
	<link rel="stylesheet" href="css/style.css">
	<!-- Javascript -->
	<script src="http://fb.me/react-0.12.2.js"></script>
	<script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
	<script src="http://underscorejs.org/underscore-min.js"></script>
</head>
<body>
	<!-- React Application -->
	<script type="text/jsx">
		var Activity = React.createClass({
			getInitialState: function() {
				return {
					position: this.props.position,
					card: this.props.card,
				}
			},
			moveCard: function() {
				this.setState({
					card: this.refs.card.getDOMNode().value,
				})
			},
			movePosition: function() {
				this.setState({
					position: this.refs.position.getDOMNode().value,
				})
			},
			render: function() {
				return (
					<li className='activity'>
						<h5>{this.props.activity}</h5>
						<input 
							onChange={this.moveCard}
							value={this.state.card}
							ref="card"
						/>
						<input 
							onChange={this.movePosition}
							value={this.state.position}
							ref="position"
						/>
					</li>
				)
			}
		});

		var Card = React.createClass({
			render: function() {
				var activities = this.props.activities.map(function(activity) {
					return (
						<Activity 
							activity={activity['name']}
							position={activity['position']}
							card={activity['card']}
						/>
					)
				});
				return (
					<li className='card'>
						<h4>{this.props.card}</h4>
						<ul>
							{activities}
						</ul>
					</li>
				)
			}
		});

		var Board = React.createClass({
			render: function() {
				var cards = this.props.cards.map(function(card) {
					return (
						<Card 
							card={card['name']} 
							activities={card['activities']} 
						/>
					)
				});
				return (
					<section className='row'>
						<h3 className='board-title'>{this.props.board}</h3>
						<ul>
							{cards}
						</ul>
					</section>
				)
			}
		});

		var App = React.createClass({
			render: function() {
				var Data = null;
				$.ajax({
					url: 'http://localhost:8000/api/v1/board/',
					method: 'GET',
					async: false,
					success: function(results) {
						Data = results;
					},
				});
				var boards = Data.map(function(board) {
					return (
						<Board 
							board={board['name']} 
							cards={board['cards']} 
						/>
					)
				});
				return (
					<main className='container'>
						{boards}
					</main>
				)
			}
		});

		React.render(<App />, document.body);
	</script>
</body>
</html>