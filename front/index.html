<html>
<head>
	<!-- Meta -->
	<meta charset="UTF-8">
	<title>Shinto</title>
	<!-- Styles -->
	<link rel="stylesheet" href="inc/bootstrap.min.css">
	<link rel="stylesheet" href="css/style.css">
	<!-- Javascript -->
	<script src="http://fb.me/react-0.12.2.js"></script>
	<script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
	<script src="http://underscorejs.org/underscore-min.js"></script>
</head>
<body>
	<header>
		<strong>Shinto - Another Kanban Clone</strong>
	</header>
	<main class="container-fluid">
		<section id="controls">
			<!-- Sorting Options -->
			<!--
			<ul id="sorting-options" class="list-unstyled">
				<li><span class="glyphicon glyphicon-th"></span></li>
				<li><span class="glyphicon glyphicon-menu-hamburger"></span></li>
			</ul>
			 -->
			<!-- Add Activities -->
			<button class="btn btn-success">
				+ <b>Add Activity</b>
			</button>
		</section>
		<section id="application"></section>
	</main>
	<!-- React Application -->
	<script type="text/jsx">
		var Activity = React.createClass({
			getInitialState: function() {
				return {
					position: this.props.position,
					card: this.props.card,
				}
			},
			moveCard: function() {
				this.setState({
					card: this.refs.card.getDOMNode().value,
				})
			},
			movePosition: function() {
				this.setState({
					position: this.refs.position.getDOMNode().value,
				})
			},
			render: function() {
				return (
					<li className='activity'>
						<h5>{this.props.activity}</h5>
						Card: <input 
							onChange={this.moveCard}
							value={this.state.card}
							ref="card"
						/><br /><br />
						Position: <input 
							onChange={this.movePosition}
							value={this.state.position}
							ref="position"
						/>
					</li>
				)
			}
		});

		var Card = React.createClass({
			getInitialState: function() {
				return {
					activities: this.props.activities.sort(function(a, b) {
						return parseFloat(a.position) - parseFloat(b.position);
					}),
				}
			},
			updateActivities: function() {
				this.setState({
					activities: this.state.activities.sort(function(a, b) {
						return parseFloat(a.position) - parseFloat(b.position);
					}),
				})
			},
			render: function() {
				var activities = this.state.activities.map(function(activity) {
					return (
						<Activity 
							activity={activity['name']}
							position={activity['position']}
							card={activity['card']}
							onChange={this.updateActivities}
						/>
					)
				});
				return (
					<li className='card'>
						<h4>{this.props.card}</h4>
						<ul>
							{activities}
						</ul>
					</li>
				)
			}
		});

		var Board = React.createClass({
			render: function() {
				var cards = this.props.cards.sort(function(a, b) {
					return parseFloat(a.id) - parseFloat(b.id);
				}).map(function(card) {
					return (
						<Card 
							card={card['name']} 
							activities={card['activities']} 
						/>
					)
				});
				return (
					<section className='row'>
						<h3 className='board-title'>{this.props.board}</h3>
						<ul>
							{cards}
						</ul>
					</section>
				)
			}
		});

		var App = React.createClass({
			retrieveData: function() {
				var Data = null;
				$.ajax({
					url: 'http://localhost:8000/api/v1/board/',
					method: 'GET',
					async: false,
					success: function(results) {
						Data = results;
					},
				});
				return Data;
			},
			render: function() {
				var boards = this.retrieveData().map(function(board) {
					return (
						<Board 
							board={board['name']} 
							cards={board['cards']} 
						/>
					)
				});
				return (
					<div>
						{boards}
					</div>
				)
			}
		});

		React.render(<App />, document.getElementById('application'));
	</script>
</body>
</html>